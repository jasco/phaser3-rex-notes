!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).rexgraphplugin=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=o(t);if(e){var i=o(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return u(this,r)}}function f(t,e,r){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}var a=function(){function t(r){e(this,t),this.scene=r}return n(t,null,[{key:"register",value:function(e,r){t.prototype[e]=r}}]),t}();var c=function(t){i(o,t);var r=h(o);function o(){return e(this,o),r.apply(this,arguments)}return n(o,[{key:"shutdown",value:function(){this.removeAllListeners()}},{key:"destroy",value:function(){this.removeAllListeners()}}]),o}(function(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&r.path)}},r.exports),r.exports}((function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}function i(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function o(t,e,n,o,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var u=new i(n,o||t,s),h=r?r+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],u]:t._events[h].push(u):(t._events[h]=u,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function u(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),u.prototype.eventNames=function(){var t,n,i=[];if(0===this._eventsCount)return i;for(n in t=this._events)e.call(t,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},u.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,s=new Array(o);i<o;i++)s[i]=n[i].fn;return s},u.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},u.prototype.emit=function(t,e,n,i,o,s){var u=r?r+t:t;if(!this._events[u])return!1;var h,f,a=this._events[u],c=arguments.length;if(a.fn){switch(a.once&&this.removeListener(t,a.fn,void 0,!0),c){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,e),!0;case 3:return a.fn.call(a.context,e,n),!0;case 4:return a.fn.call(a.context,e,n,i),!0;case 5:return a.fn.call(a.context,e,n,i,o),!0;case 6:return a.fn.call(a.context,e,n,i,o,s),!0}for(f=1,h=new Array(c-1);f<c;f++)h[f-1]=arguments[f];a.fn.apply(a.context,h)}else{var l,v=a.length;for(f=0;f<v;f++)switch(a[f].once&&this.removeListener(t,a[f].fn,void 0,!0),c){case 1:a[f].fn.call(a[f].context);break;case 2:a[f].fn.call(a[f].context,e);break;case 3:a[f].fn.call(a[f].context,e,n);break;case 4:a[f].fn.call(a[f].context,e,n,i);break;default:if(!h)for(l=1,h=new Array(c-1);l<c;l++)h[l-1]=arguments[l];a[f].fn.apply(a[f].context,h)}}return!0},u.prototype.on=function(t,e,r){return o(this,t,e,r,!1)},u.prototype.once=function(t,e,r){return o(this,t,e,r,!0)},u.prototype.removeListener=function(t,e,n,i){var o=r?r+t:t;if(!this._events[o])return this;if(!e)return s(this,o),this;var u=this._events[o];if(u.fn)u.fn!==e||i&&!u.once||n&&u.context!==n||s(this,o);else{for(var h=0,f=[],a=u.length;h<a;h++)(u[h].fn!==e||i&&!u[h].once||n&&u[h].context!==n)&&f.push(u[h]);f.length?this._events[o]=1===f.length?f[0]:f:s(this,o)}return this},u.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&s(this,e)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,t.exports=u}))),l=function(t,e,r){if(t&&"number"!=typeof t){if(t.hasOwnProperty(e))return t[e];if(-1!==e.indexOf(".")){for(var n=e.split("."),i=t,o=r,s=0;s<n.length;s++){if(!i.hasOwnProperty(n[s])){o=r;break}o=i[n[s]],i=i[n[s]]}return o}return r}return r},v=new(function(){function t(r){e(this,t),this.nextId=l(r,"start",1),this.uidKey=l(r,"uidKey","$uid"),this.autoRemove=l(r,"remove",!0),this.refs={},this.count=0}return n(t,[{key:"add",value:function(t,e){var r=this.refs,n=this.uidKey;if(n&&null!=(e=t[n]))return this;if(null==e)do{e=this.nextId,this.nextId++}while(r.hasOwnProperty(e));return r.hasOwnProperty(e)?e=null:(r[e]=t,this.count++,n&&(t[n]=e),this.autoRemove&&t.on&&t.on("destroy",(function(){this.remove(e)}),this)),n?this:e}},{key:"addMultiple",value:function(t){for(var e=0,r=t.length;e<r;e++)this.add(t[e]);return this}},{key:"get",value:function(t){return this.refs[t]}},{key:"has",value:function(t){return this.refs.hasOwnProperty(t)}},{key:"remove",value:function(t){var e=this.refs;if(e.hasOwnProperty(t)){if(this.uidKey)e[t][this.uidKey]=void 0;delete e[t],this.count--}return this}},{key:"forEach",value:function(t,e){var r,n=this.refs;for(var i in n)r=n[i],e?t.call(e,r,i):t(r,i)}},{key:"clear",value:function(){this.forEach((function(t){this.remove(t)}),this)}}]),t}())({uidKey:"$uid",remove:!1}),p=v.uidKey,y=function(){function r(t,n){e(this,r),this.parent=t,v.add(this,n),this.graph=null,this.type=void 0,this.boot()}return n(r,[{key:"boot",value:function(){var e=t(this.parent);"number"!==e&&"string"!==e&&this.parent.once&&this.parent.on("destroy",this.destroy,this)}},{key:"destroy",value:function(){this.graph&&this.graph.remove(this[p]),v.remove(this[p]),this.parent=void 0,this.setGraph(null)}},{key:"setGraph",value:function(t){return this.graph=t,t||this.setType(void 0),this}},{key:"setType",value:function(t){return"string"==typeof t&&(t=d[t]),this.type=t,this}},{key:"isVertex",get:function(){return!!this.graph&&0===this.type}},{key:"isEdge",get:function(){return!!this.graph&&1===this.type}}]),r}();Object.assign(y.prototype,{});var d={vertex:0,edge:1},g=function(e){var r=t(e);return"number"===r||"string"===r},b=function(t){return g(t)?v.get(t):(t.hasOwnProperty("rexGraphItem")||(t.rexGraphItem=new y(t)),t.rexGraphItem)},x={"->":1,"<-":2,"<->":3},O=function(t){return null==t?null:v.get(t).parent},m=function(t,e,r,n){var i=t-r,o=e-n;return Math.sqrt(i*i+o*o)},w={"breadth-first":0,bfs:0,"depth-first":1,dfs:1},j={getEdgeData:function(t,e){void 0===e&&(e=!1);var r=this.getObjUID(t);return e&&!this.edges.hasOwnProperty(r)&&(this.edges[r]={}),this.edges[r]},isEdge:function(t){var e=this.getObjUID(t);return this.edges.hasOwnProperty(e)},addEdge:function(t,e,r,n){if(this.isEdge(t))return this;void 0===n&&(n=3);var i=this.getObjUID(t),o=this.getEdgeData(i,!0);o.dir=n,o.vA=this.getObjUID(e),o.vB=this.getObjUID(r),b(t).setGraph(this),this.edgeCount++,this.addVertex(e).addVertex(r);var s=this.getVertexData(e,!0),u=this.getVertexData(r,!0);return"string"==typeof n&&(n=x(n)),1&n&&(s[i]=o.vB),2&n&&(u[i]=o.vA),this},removeEdge:function(t,e){if(this.isEdge(t))return this;void 0===e&&(e=!1);var r=this.getObjUID(t);return delete this.edges[r],this.edgeCount--,b(t).setGraph(null),e&&t.destroy&&gameObject.destroy(),this},getAllEdges:function(t){var e;for(var r in void 0===t&&(t=[]),this.edges)(e=O(r))&&t.push(e);return t},getEdgesOfVertex:function(t,e){void 0===e&&(e=[]);var r,n=this.getVertexData(t);if(!n)return e;for(var i in n)(r=O(i))&&e.push(r);return e},getEdgeLength:function(t){var e=this.getEdgeData(t);if(!e)return 0;var r=O(e.vA),n=O(e.vB);return r&&n?m(r.x,r.y,n.x,n.y):0},isInLoop:function(t){if(!this.isVertex(t))return!1;for(var e,r,n,i,o,s=this.getObjUID(t),u=[[s,null]],h={};u.length>0;){if(r=(e=u.pop())[0],n=e[1],r===s&&null!==n)return!0;for(n in null!==n&&(h[n]=!0),i=this.getVertexData(r))h.hasOwnProperty(n)||(o=i[n],u.push([o,n]))}return!1},getVertexData:function(t,e){void 0===e&&(e=!1);var r=this.getObjUID(t);return e&&!this.vertices.hasOwnProperty(r)&&(this.vertices[r]={}),this.vertices[r]},isVertex:function(t){var e=this.getObjUID(t);return this.vertices.hasOwnProperty(e)},addVertex:function(t){return this.isVertex(t)||(this.getVertexData(t,!0),b(t).setGraph(this),this.vertexCount++),this},addVertices:function(t){for(var e=0,r=t.length;e<r;e++)this.addVertex(t[e]);return this},removeVertex:function(t,e,r){if(!this.isVertex(t))return this;void 0===e&&(e=!1),void 0===r&&(r=!0);var n=this.getObjUID(t);if(r){var i=this.getVertexData(n);for(var o in i)this.removeEdge(o,e)}return delete this.vertices[n],this.vertexCount--,b(t).setGraph(null),e&&t.destroy&&gameObject.destroy(),this},removeAllVertices:function(t){for(var e in this.vertices)this.removeVertex(e,t);return this},getAllVertices:function(t){var e;for(var r in void 0===t&&(t=[]),this.vertices)(e=O(r))&&t.push(e);return t},getVerticesOfEdge:function(t,e){void 0===e&&(e=[]);var r,n=this.getEdgeData(t);return n?((r=O(n.vA))&&e.push(r),(r=O(n.vB))&&e.push(r),e):e},getOppositeVertex:function(t,e){var r=this.getVertexData(t);if(r){var n=this.getObjUID(e);if(n)return O(r[n])}},getAllConnectedVertices:function(t,e,r){if(void 0===e&&(e=[]),"string"==typeof r&&(r=w[r]),void 0===r&&(r=0),!this.isVertex(t))return e;for(var n,i,o=this.getObjUID(t),s=0===r,u=[o],h={};u.length>0;)if(n=s?u.shift():u.pop(),!h.hasOwnProperty(n))for(var f in h[n]=!0,n!==o&&e.push(O(n)),this.getVertexData(n))i=this.getOppositeVertex(n,f),h.hasOwnProperty(i)||u.push(i);return e},getNeighborVertices:function(t,e){void 0===e&&(e=[]);var r,n=this.getVertexData(t);if(n)for(var i in n)(r=O(n[i]))&&e.push(r);return e},areNeighborVertices:function(t,e){var r=this.getObjUID(t),n=this.getObjUID(e);if(null!=r&&null!=n){var i=this.getVertexData(t);for(var o in n=parseInt(n),i)if(i[o]===n)return!0}return!1}},V=v.uidKey,_=function(t){i(s,t);var r=h(s);function s(t){var n;return e(this,s),(n=r.call(this)).scene=t,n.vertices={},n.edges={},n.vertexCount=0,n.edgeCount=0,n.boot(),n}return n(s,[{key:"boot",value:function(){this.scene&&this.scene.events.once("shutdown",this.destroy,this)}},{key:"shutdown",value:function(){return this.clear(),f(o(s.prototype),"shutdown",this).call(this),this.scene=void 0,this.vertices=void 0,this.edges=void 0,this.vertexCount=0,this.edgeCount=0,this}},{key:"destroy",value:function(){return this.emit("destroy"),this.shutdown(),this}},{key:"exists",value:function(t){return this.isEdge(t)||this.isVertex(t)}},{key:"remove",value:function(t){return this.isEdge(t)?this.removeEdge(t):this.isVertex(t)&&this.removeVertex(t),this}},{key:"clear",value:function(t){return void 0===t&&(t=!0),this.removeAllVertices(t),this}},{key:"getObjUID",value:function(t){return function(t){return g(t)?t:b(t)[V]}(t)}}]),s}(c);Object.assign(_.prototype,j);var D=function(t){return null==t||""===t||0===t.length};return a.register("graph",(function(t){return new _(this.scene,t)})),function(e,r,n){if("object"===t(e)){if(D(r)){if(null==n)return;"object"===t(n)&&(e=n)}else{"string"==typeof r&&(r=r.split("."));var i=r.pop();(function(e,r,n){var i=e;if(D(r));else{var o;"string"==typeof r&&(r=r.split("."));for(var s=0,u=r.length;s<u;s++){var h;if(null==i[o=r[s]]||"object"!==t(i[o]))h=s===u-1?void 0===n?{}:n:{},i[o]=h;i=i[o]}}return i}(e,r))[i]=n}}}(window,"RexPlugins.Graph.Graph",_),function(t){i(n,Phaser.Plugins.ScenePlugin);var r=h(n);function n(t,i){var o;return e(this,n),(o=r.call(this,t,i)).add=new a(t),o}return n}()}));
