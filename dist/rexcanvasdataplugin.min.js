!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).rexcanvasdataplugin=e()}(this,(function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function o(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=n(t);if(e){var u=n(this).constructor;r=Reflect.construct(i,arguments,u)}else r=i.apply(this,arguments);return o(this,r)}}function s(t,e,r){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}var f=Phaser.Display.Color,a={rgbaToColor32:function(t,e,r,n){return n<<24|t<<16|e<<8|r},color32ToColorInt:function(t){return 16777215&t},color32ToAlpha:function(t){return t>>>24},color32ToColorObject:function(t,e){var r=t>>16&255,n=t>>8&255,i=255&t,o=t>>24&255;return void 0===e?e=new f(r,i,n,o):e.setTo(r,i,n,o),e}},c=function(){function e(r,n,i){t(this,e),void 0===n&&(n=0),void 0===i&&(i=n),this.width=n,this.height=i,this.buffer=new r(n*i)}return r(e,[{key:"getOffset",value:function(t,e){return e*this.width+t}},{key:"get",value:function(t,e){var r;return r=2===arguments.length?this.getOffset(t,e):t,this.buffer.get(r)}},{key:"set",value:function(t,e,r){var n;return 3===arguments.length?n=this.getOffset(t,e):(n=t,r=e),this.buffer.set(n,r),this}},{key:"fill",value:function(t,e,r,n,i,o,u){if("number"==typeof t){var s=t;this.buffer.fill(s)}else{void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=t.width-e),void 0===i&&(i=t.height-r),this.resize(n,i);for(var f,a=t.getContext("2d").getImageData(e,r,n,i).data,c=0,h=a.length/4;c<h;c++)f=4*c,s=u?o.call(u,a,f):o(a,f),this.set(c,s)}return this}},{key:"clear",value:function(){return this.fill(0),this}},{key:"resize",value:function(t,e){return this.width===t&&this.height===e||(this.width=t,this.height=e,this.buffer.resize(t*e)),this}},{key:"forEach",value:function(t,e,r){var n;void 0===r&&(r=!1);for(var i=0,o=this.height;i<o;i++)for(var u=0,s=this.width;u<s;u++)n=this.get(u,i),(!r||0!==n&&!1!==n)&&(e?t.call(e,n,u,i,this):t(n,u,i,this));return this}},{key:"forEachNonZero",value:function(t,e){return this.forEach(t,e,!0),this}}]),e}();Object.assign(c.prototype,a);var h=function(t,e,r,n,i,o,u,s,f){return void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=t.width-e),void 0===i&&(i=t.height-r),void 0===f&&(f=new c(o,n,i)),f.fill(t,e,r,n,i,u,s),f},l=function(){function e(r){t(this,e),this.resize(r)}return r(e,[{key:"get",value:function(t){var e=t>>3,r=1<<t%8;return(this._bin[e]&r)>0}},{key:"set",value:function(t,e){var r=t>>3,n=1<<t%8;return e?this._bin[r]|=n:(n^=255,this._bin[r]&=n),this}},{key:"fill",value:function(t){t=t?255:0;for(var e=0,r=this._rows;e<r;e++)this._bin[e]=t;return this}},{key:"resize",value:function(t){var e=1+(t>>3);return e!==this._rows&&(this._rows=e,this._buf=new ArrayBuffer(this._rows),this._bin=new Uint8Array(this._buf)),this}}]),e}(),v=function(t,e){return t[e+3]>0},d=function(){function e(r){t(this,e),this.resize(r)}return r(e,[{key:"get",value:function(t){return this._colors[t]}},{key:"set",value:function(t,e){return this._colors[t]=e,this}},{key:"fill",value:function(t){for(var e=0,r=this._rows;e<r;e++)this._colors[e]=t;return this}},{key:"resize",value:function(t){return t!==this._rows&&(this._rows=t,this._buf=new ArrayBuffer(4*this._rows),this._colors=new Uint32Array(this._buf)),this}}]),e}(),y=function(t,e){return t[e+3]<<24|t[e+0]<<16|t[e+1]<<8|t[e+2]},p=Phaser.GameObjects.GameObject,g=Phaser.Display.Canvas.CanvasPool,b=function(t,e){return e.width=t.cutWidth,e.height=t.cutHeight,e.getContext("2d").drawImage(t.source.image,t.cutX,t.cutY,t.cutWidth,t.cutHeight),e},w={textObjectToBitMap:function(t,e){return h(t.canvas,void 0,void 0,void 0,void 0,l,v,void 0,e)},textureTColorMap:function(t,e,r){var n;"string"==typeof t?("string"!=typeof e&&(r=e,e=void 0),n=this.textureManager.getFrame(t,e)):(n=t instanceof p?t.frame:t,r=e);var i=void 0!==this._tmpCanvas,o=i?this._tmpCanvas:g.create2D(this,void 0,void 0,void 0,!0);return r=h(b(n,o),void 0,void 0,void 0,void 0,d,y,void 0,r),i?(o.width=1,o.height=1):g.remove(o),r}},_=Phaser.Display.Canvas.CanvasPool,m=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}(f,Phaser.Plugins.BasePlugin);var o=u(f);function f(e){return t(this,f),o.call(this,e)}return r(f,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this),this._tmpCanvas=_.create2D(this)}},{key:"destroy",value:function(){_.remove(this._tmpCanvas),this._tmpCanvas=void 0,s(n(f.prototype),"destroy",this).call(this)}},{key:"textureManager",get:function(){return this.game.textures}}]),f}();return Object.assign(m.prototype,w),m}));
